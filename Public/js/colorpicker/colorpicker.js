jQuery.fn.farbtastic=function(a){$.farbtastic(this,a);return this};jQuery.farbtastic=function(a,b){var a=$(a).get(0);return(a.farbtastic=new jQuery._farbtastic(a,b))};jQuery._farbtastic=function(container,callback){var fb=this;$(container).html('<div class="farbtastic" id="'+callback+'_ssd"><div class="colors"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var e=$('.farbtastic',container);fb.wheel=$('.wheel',container).get(0);fb.radius=84;fb.square=100;fb.width=194;if(navigator.appVersion.match(/MSIE [0-6]\./)){$('*',e).each(function(){if(this.currentStyle.backgroundImage!='none'){var a=this.currentStyle.backgroundImage;a=this.currentStyle.backgroundImage.substring(5,a.length-2);$(this).css({'backgroundImage':'none','filter':"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"})}})};fb.linkTo=function(a){if(typeof fb.callback=='object'){$(fb.callback).unbind('keyup',fb.updateValue)}fb.color=null;if(typeof a=='function'){fb.callback=a}else if(typeof a=='object'||typeof a=='string'){fb.callback=$(a);fb.callback.bind('keyup',fb.updateValue);if(fb.callback.get(0).value){fb.setColor(fb.callback.get(0).value)}}return this};fb.updateValue=function(a){if(this.value&&this.value!=fb.color){fb.setColor(this.value)}};fb.setColor=function(a){var b=fb.unpack(a);if(fb.color!=a&&b){fb.color=a;fb.rgb=b;fb.hsl=fb.RGBToHSL(fb.rgb);fb.updateDisplay()}return this};fb.setHSL=function(a){fb.hsl=a;fb.rgb=fb.HSLToRGB(a);fb.color=fb.pack(fb.rgb);fb.updateDisplay();return this};fb.widgetCoords=function(a){var x,y;var b=a.target||a.srcElement;var c=fb.wheel;if(typeof a.offsetX!='undefined'){var d={x:a.offsetX,y:a.offsetY};var e=b;while(e){e.mouseX=d.x;e.mouseY=d.y;d.x+=e.offsetLeft;d.y+=e.offsetTop;e=e.offsetParent}var e=c;var f={x:0,y:0};while(e){if(typeof e.mouseX!='undefined'){x=e.mouseX-f.x;y=e.mouseY-f.y;break}f.x+=e.offsetLeft;f.y+=e.offsetTop;e=e.offsetParent}e=b;while(e){e.mouseX=undefined;e.mouseY=undefined;e=e.offsetParent}}else{var d=fb.absolutePosition(c);x=(a.pageX||0*(a.clientX+$('html').get(0).scrollLeft))-d.x;y=(a.pageY||0*(a.clientY+$('html').get(0).scrollTop))-d.y}return{x:x-fb.width/2,y:y-fb.width/2}};fb.mousedown=function(a){if(!document.dragging){$(document).bind('mousemove',fb.mousemove).bind('mouseup',fb.mouseup);document.dragging=true}var b=fb.widgetCoords(a);fb.circleDrag=Math.max(Math.abs(b.x),Math.abs(b.y))*2>fb.square;fb.mousemove(a);return false};fb.mousemove=function(a){var b=fb.widgetCoords(a);if(fb.circleDrag){var c=Math.atan2(b.x,-b.y)/6.28;if(c<0)c+=1;fb.setHSL([c,fb.hsl[1],fb.hsl[2]])}else{var d=Math.max(0,Math.min(1,-(b.x/fb.square)+.5));var e=Math.max(0,Math.min(1,-(b.y/fb.square)+.5));fb.setHSL([fb.hsl[0],d,e])}return false};fb.mouseup=function(){$(document).unbind('mousemove',fb.mousemove);$(document).unbind('mouseup',fb.mouseup);document.dragging=false};fb.updateDisplay=function(){var a=fb.hsl[0]*6.28;$('.h-marker',e).css({left:Math.round(Math.sin(a)*fb.radius+fb.width/2)+'px',top:Math.round(-Math.cos(a)*fb.radius+fb.width/2)+'px'});$('.sl-marker',e).css({left:Math.round(fb.square*(.5-fb.hsl[1])+fb.width/2)+'px',top:Math.round(fb.square*(.5-fb.hsl[2])+fb.width/2)+'px'});$('.colors',e).css('backgroundColor',fb.pack(fb.HSLToRGB([fb.hsl[0],1,0.5])));if(typeof fb.callback=='object'){$(fb.callback).css({backgroundColor:fb.color,color:fb.hsl[2]>0.5?'#000':'#fff'});$(fb.callback).each(function(){if(this.value&&this.value!=fb.color){this.value=fb.color}});if(callback=='#color-background'){$("body").css("backgroundColor",fb.color)}else if(callback=='#color-links'){$("a").css("color",fb.color);$('#navigation a').css("color","#2b4a78");$('#header span').css("color","#000000")}else if(callback=='#color-text'){$("body").css("color",fb.color)}else if(callback=='#color-sidebar'){$("#sidebar").css("background",fb.color)}else if(callback=='#color-sidebox'){$("#sidebar").css("borderColor",fb.color);$(".userauth").css("borderColor",fb.color);$(".sect").css("border-top","1px solid "+fb.color);$(".first-sect").css("border-top","0px");$(".sidebang").css("border-bottom","1px dashed "+fb.color);$(".authdot").css("border-bottom","1px dashed "+fb.color);$(".homestabs > .menu>li>a").css("border-top","1px dashed "+fb.color)}}else if(typeof fb.callback=='function'){fb.callback.call(fb,fb.color)}};fb.absolutePosition=function(a){var r={x:a.offsetLeft,y:a.offsetTop};if(a.offsetParent){var b=fb.absolutePosition(a.offsetParent);r.x+=b.x;r.y+=b.y}return r};fb.pack=function(a){var r=Math.round(a[0]*255);var g=Math.round(a[1]*255);var b=Math.round(a[2]*255);return'#'+(r<16?'0':'')+r.toString(16)+(g<16?'0':'')+g.toString(16)+(b<16?'0':'')+b.toString(16)};fb.unpack=function(a){if(a.length==7){return[parseInt('0x'+a.substring(1,3))/255,parseInt('0x'+a.substring(3,5))/255,parseInt('0x'+a.substring(5,7))/255]}else if(a.length==4){return[parseInt('0x'+a.substring(1,2))/15,parseInt('0x'+a.substring(2,3))/15,parseInt('0x'+a.substring(3,4))/15]}};fb.HSLToRGB=function(a){var c,m2,r,g,b;var h=a[0],s=a[1],l=a[2];m2=(l<=0.5)?l*(s+1):l+s-l*s;c=l*2-m2;return[this.hueToRGB(c,m2,h+0.33333),this.hueToRGB(c,m2,h),this.hueToRGB(c,m2,h-0.33333)]};fb.hueToRGB=function(a,b,h){h=(h<0)?h+1:((h>1)?h-1:h);if(h*6<1)return a+(b-a)*h*6;if(h*2<1)return b;if(h*3<2)return a+(b-a)*(0.66666-h)*6;return a};fb.RGBToHSL=function(a){var c,max,delta,h,s,l;var r=a[0],g=a[1],b=a[2];c=Math.min(r,Math.min(g,b));max=Math.max(r,Math.max(g,b));delta=max-c;l=(c+max)/2;s=0;if(l>0&&l<1){s=delta/(l<0.5?(2*l):(2-2*l))}h=0;if(delta>0){if(max==r&&max!=g)h+=(g-b)/delta;if(max==g&&max!=b)h+=(2+(b-r)/delta);if(max==b&&max!=r)h+=(4+(r-g)/delta);h/=6}return[h,s,l]};$('*',e).mousedown(fb.mousedown);fb.setColor('#000000');if(callback){fb.linkTo(callback)}}