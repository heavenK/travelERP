<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><{$navtitle}></title>

<script language="javascript" type="text/javascript">
    function setMeg()
    {
         var synum="";
         var adult=document.getElementById("tbMan");
         var child=document.getElementById("tbChild");
         var state=document.getElementById("dlState");
         var person=document.getElementById("tbPerson");
         var phone=document.getElementById("tbPhone");
		 var cut=document.getElementById("tbCut");
		 var cut1=document.getElementById("tbCut1");
		 
		 var adult_price=document.getElementById("chengren_price");
		 var child_price=document.getElementById("ertong_price");
        if(person.value=="")
        {
            alert("请填写联系人");
            person.focus();
            return false;
        }
		
         if(phone.value=="")
        {
            alert("请填写联系人电话");
            phone.focus();
            return false;
        }
        
        if((adult.value=="")&&(child.value==""))
        {
            alert("请输入人数");
             adult.focus();
            return false;
        }
		if((cut.value=="")&&(cut.value==""))
        {
            alert("请输入成人折扣");
             cut.focus();
            return false;
        }
		if((cut1.value=="")&&(cut1.value==""))
        {
            alert("请输入儿童折扣");
             cut.focus();
            return false;
        }
        if((adult.value==0)&&(child.value==0))
        {
            alert("请输入大于0的数字");
            adult.focus();
            return false;
        }
		if((adult_price.value<0)&& (adult_price.value<0))
        {
            alert("请保证成人价格不小于0");
            adult.focus();
            return false;
        }
		if((child_price.value<0)&&(child_price.value<0))
        {
            alert("请保证儿童价格不小于0");
            adult.focus();
            return false;
        }
        if((adult.value>=50)||(child.value>=50))
        {
            alert("请输入小于50的数字");
            adult.focus();
            return false;
        }
        if(state.value=="")
        {
            alert("请选择状态类型");
            state.focus();
            return false;
        }
        
        if(state.value=="1"&&(parseInt(adult.value)>parseInt(synum)||parseInt(child.value)>parseInt(synum)||(parseInt(adult.value)+parseInt(child.value))>parseInt(synum)))
        {
            alert("余位不足，请重新填写人数");
            adult.focus();
            return false;
        }
        
        if(state.value=="2"&&(parseInt(adult.value)>parseInt(synum)||parseInt(child.value)>parseInt(synum)||(parseInt(adult.value)+parseInt(child.value))>parseInt(synum)))
        {
            return confirm("余位不足，订单将转为候补状态，确认继续?");
        }
       
        return　true;
    }

	function Getthisvalue(obj,maxcut,price,tab)
	{
		if (Number(obj.value) > maxcut) {
			obj.value = 0;
			alert('您输入的值超过' +maxcut + '了！');
		}
		document.getElementById(tab).value  = price - Number(obj.value);
	}

    function CheckState()
    {
        var state=document.getElementById("dlState");
        if(state.value=="1")
        {
            alert("您选择了占位状态，请在48小时内转为确认，否则系统会自动取消该订单！");
        }
        return true;
    }
	
	
	function dochange(id)
	{
		var type = document.getElementById("type").value;
		window.location.href = "<{:SITE_MENSHI}>Index/baoming/zituanID/"+id+"/type/"+type;
	}
	
    </script>    
    
    
    <include file="Index:navlist" />
    <style>
.tb1 {
	border-left:1px dashed #CCCCCC;
	border-bottom:1px dashed #CCCCCC
}
.tb1 tr td {
	border-top:1px dashed #CCCCCC;
	border-right:1px dashed #CCCCCC
}
.anu {
	BORDER-RIGHT-WIDTH: 0px;
	TEXT-TRANSFORM: uppercase;
	WIDTH: 89px;
	DISPLAY: block;
	BORDER-TOP-WIDTH: 0px;
	BORDER-BOTTOM-WIDTH: 0px;
	HEIGHT: 23px;
	COLOR: #fff;
	BORDER-LEFT-WIDTH: 0px;
	BACKGROUND: url('<{:__PUBLIC__}>/gulianstyle/images/anu.gif') no-repeat left top;
}
</style>
    <div class="ks_box">
    <!--整体-->

    <form name="form1" method="post" action="<{:SITE_MENSHI}>Index/dopostbaoming" id="form1">
      <input type="hidden" name="type" value="<{$type}>" />
      <input type="hidden" name="tuanhao" value="<{$zituan['tuanhao']}>" />
      <input type="hidden" name="zituanID" value="<{$zituan['zituanID']}>" />
      <table width="100%" class="tb1" cellpadding="0" cellspacing="0">
        <tbody>
          <tr>
            <td colspan="3" height="27" align="left" ><h4><img src="<{:__PUBLIC__}>/gulianstyle/images/bmbbj.gif"></img> 报名表 </h4></td>
            <td align="right"><a href="javascript:void(0)" onclick="window.history.back();"> <img src="<{:__PUBLIC__}>/gulianstyle/styles/A_ddgl-03.jpg"> </a></td>
          </tr>
          <tr>
            <td align="left" style="height: 32px"> 线路名称： </td>
            <td colspan="3" style="height: 32px"><span id="lbLinename"><{$xianlu['mingcheng']}></span></td>
          </tr>
          <tr>
            <td align="left" style="height: 32px"> 团号：</td>
            <td align="left" style="height: 32px"><{$zituan['tuanhao']}></td>
            <td align="left" style="height: 32px"> 出团日期：</td>
            <td align="left" style="height: 32px"><{$zituan['chutuanriqi']}></td>
          </tr>
          <tr>
            <td align="left" style="height: 32px"> 报名公司：</td>
            <td align="left" style="height: 32px"><{$company['companyname']}></td>
            <td align="left" style="height: 32px"> 操作人：</td>
            <td align="left" style="height: 32px"><{$roleuser['realname']}></td>
          </tr>
          <tr>
            <td align="left" style="height: 32px"> 报名公司电话：</td>
            <td align="left" style="height: 32px"><{$roleuser['officetel']}></td>
            <td align="left" style="height: 32px"> 报名公司地址：</td>
            <td align="left" style="height: 32px"><{$company['addr']}></td>
          </tr>
          <tr>
            <td align="left" style="height: 27px;"> 剩余名额：</td>
            <td style="height: 27px; width: 288px;"><span id="lbSyno"><{$shengyu}></span></td>
            <td align="left" style="height: 27px; width: 156px;">所属人：</td>
            <td align="left" style="height: 32px">
            	<select name="owner">
                	<option value="<{$roleuser['user_name']}>"><{$roleuser['realname']}></option>
                    <php>foreach($kehu_all as $kehu){</php>
                    <option value="<{$kehu['user_name']}>"><{$kehu['realname']}></option>
                    <php>}</php>
                </select>
            </td>
          </tr>
            <php>
        
        if($xianlujiage[airhotlenumber]){
          </php>
        
        <tr>
          <td align="left" style="height: 32px"> 订单类型：</td>
          <td align="left" style="height: 32px"><select name="type" id="type" onchange="javascript:dochange('<{$zituan['zituanID']}>')" >
              <php>if($type){</php>
              <option value="<{$type}>"><{$type}></option>
              <option disabled="disabled">--------------</option>
              <php>}</php>
              <option value="包团">包团</option>
              <option value="机票酒店">机票酒店</option>
              <option value="机票">机票</option>
              <option value="酒店">酒店</option>
            </select></td>
          <td align="left" style="height: 32px"></td>
          <td align="left" style="height: 32px"></td>
        </tr>
        <php>}</php>
        <tr>
          <td align="left" style="height: 32px"> 可选大客户：</td>
          <td align="left" style="height: 32px"><select name="bigmanID" id="bigmanID">
              <option value="">散客</option>
              <php>foreach($bigmanAll as $bigman){</php>
              <option value="<{$bigman[id]}>"><{$bigman[title]}></option>
              <php>}</php>
            </select></td>
          <td align="left" style="height: 32px"></td>
          <td align="left" style="height: 32px"></td>
        </tr>
        <tr>
          <td align="left" style="height: 32px"> 联系人：</td>
          <td align="left" style="height: 32px"><input name="lianxiren" type="text" id="tbPerson"></td>
          <td align="left" style="height: 32px"> 联系电话：</td>
          <td align="left" style="height: 32px"><input name="telnum" type="text" id="tbPhone"></td>
        </tr>
        <tr>
          <td align="left" style="height: 32px"> 地址：</td>
          <td align="left" style="height: 32px"><input name="" type="text" id="tbAddress"></td>
          <td align="left" style="height: 32px"> 订单状态：</td>
          <td align="left" style="height: 32px"><select name="zhuangtai" id="dlState" onchange="return CheckState();">
              <option value="占位">占位</option>
              <option value="确认">确认</option>
            </select></td>
        </tr>
        <tr>
          <td align="left" style="height: 32px"> 成人人数：</td>
          <td align="left" style="height: 32px"><input name="chengrenshu" type="text" maxlength="2" id="tbMan" onkeyup="this.value=this.value.replace(/[^0-9]/g, '')"></td>
          <td align="left" style="height: 32px"> 儿童人数：</td>
          <td align="left" style="height: 32px"><input name="ertongshu" type="text" maxlength="2" id="tbChild" onkeyup="this.value=this.value.replace(/[^0-9]/g, '')"></td>
        </tr>
        <php>if($airhotle == 1){</php>
        <tr>
          <td align="left" style="height: 32px"> 成人折扣：</td>
          <td align="left" style="height: 32px"><input name="adult_cut" type="text" maxlength="10" id="tbCut" value="0" onkeyup="this.value=this.value.replace(/[^0-9]/g, '');Getthisvalue(this,'<{$jiage['cut']}>','<{$jiage['adultcost']}>','chengren_price');">
            (MAX:
            <php>if($jiage['cut']) echo $jiage['cut']; else echo 0;</php>
            元) </td>
            </td>
          <td align="left" style="height: 32px"> 儿童折扣：</td>
          <td align="left" style="height: 32px"><input name="child_cut" type="text" maxlength="10" id="tbCut1" value="0" onkeyup="this.value=this.value.replace(/[^0-9]/g, '');Getthisvalue(this,'<{$jiage['cut']}>','<{$jiage['childcost']}>','ertong_price');">
            (MAX:
            <php>if($jiage['cut']) echo $jiage['cut']; else echo 0;</php>
            元)</td>
        </tr>
        <tr>
          <td align="left" style="height: 32px"> 成人价格：</td>
          <td align="left" style="height: 32px"><input name="chengren_price" type="text" maxlength="10" id="chengren_price" value="<{$jiage['adultcost']}>" readonly></td>
          <td align="left" style="height: 32px"> 儿童价格：</td>
          <td align="left" style="height: 32px"><input name="ertong_price" type="text" maxlength="10" id="ertong_price" value="<{$jiage['childcost']}>" readonly></td>
        </tr>
        <php>}else{</php>
        <tr>
          <td align="left" style="height: 32px"> 成人折扣：</td>
          <td align="left" style="height: 32px"><input name="adult_cut" type="text" maxlength="10" id="tbCut" value="0" onkeyup="this.value=this.value.replace(/[^0-9]/g, '');Getthisvalue(this,'<{$cut}>','<{$chengren_price}>','chengren_price');">
            (MAX:
            <php>if($cut) echo $cut; else echo 0;</php>
            元) </td>
            </td>
          <td align="left" style="height: 32px"> 儿童折扣：</td>
          <td align="left" style="height: 32px"><input name="child_cut" type="text" maxlength="10" id="tbCut1" value="0" onkeyup="this.value=this.value.replace(/[^0-9]/g, '');Getthisvalue(this,'<{$cut}>','<{$ertong_price}>','ertong_price');">
            (MAX:
            <php>if($cut) echo $cut; else echo 0;</php>
            元)</td>
        </tr>
        <tr>
          <td align="left" style="height: 32px"> 成人价格：</td>
          <td align="left" style="height: 32px"><input name="chengren_price" type="text" maxlength="10" id="chengren_price" value="<{$chengren_price}>" readonly>
          <php>if($chengren_chengben){</php>
          (成本：<{$chengren_chengben}>元)
          <php>}</php>
          </td>
          <td align="left" style="height: 32px"> 儿童价格：</td>
          <td align="left" style="height: 32px"><input name="ertong_price" type="text" maxlength="10" id="ertong_price" value="<{$ertong_price}>" readonly>
          <php>if($ertong_chengben){</php>
          (成本：<{$ertong_chengben}>元)
          <php>}</php>
          </td>
        </tr>
        <php>}</php>
        <tr>
          <td align="left" style="height: 32px"> 目前以有<{$renshu}>人报名。</td>
          <td align="left" style="height: 32px" colspan="3"><php>foreach($chengben_all as $key => $chengben){
              if($key == 0) echo "当人数小于".$chengben['renshu']."时，成本为".$chengben['chengben']."元。<br />
              ";
              else {
              echo "当人数小于".$chengben['renshu']."，大于".$chengben_all[$key-1]['renshu']."时，成本为".$chengben['chengben']."元。<br />
              ";
              }
              }</php></td>
        </tr>
        <tr>
          <td align="left" style="height: 32px" colspan="4"></td>
        </tr>
        
        <tr>
          <td align="left" style="height: 32px"> 验证码：</td>
          <td align="left" style="height: 32px" colspan="3"><input style=" height:18px;width:80px;float:left; margin-right:5px;" type='text' name='verifyTest'>
            <img style="float:left" style='cursor:pointer' title='刷新验证码' src='<{:SITE_MENSHI}>Index/verify' id='verifyImg' onClick='freshVerify()'/></td>
        </tr>
        
        <script type='text/javascript'>  
		//重载验证码  
		function freshVerify() {  
		  document.getElementById('verifyImg').src='__URL__/verify/'+Math.random();  
		}  
		</script>
          </tbody>
        
      </table>
      <hr>
      <table width="100%" border="0" cellpadding="0" cellspacing="0">
        <tbody>
          <tr>
            <td align="center" colspan="5" style="height: 32px"><input type="submit" value="保 存" id="Button1" onclick="return setMeg();"  class="anu"></td>
          </tr>
        </tbody>
      </table>
    </form>

    </body>
</html>
